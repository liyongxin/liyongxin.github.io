<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: nginx | Earlene]]></title>
  <link href="http://liyongxin.github.io/blog/categories/nginx/atom.xml" rel="self"/>
  <link href="http://liyongxin.github.io/"/>
  <updated>2019-06-27T19:27:31+08:00</updated>
  <id>http://liyongxin.github.io/</id>
  <author>
    <name><![CDATA[yxli@alauda.io]]></name>
    <email><![CDATA[yxli@alauda.io]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[supervisord 管理nginx app]]></title>
    <link href="http://liyongxin.github.io/blog/2019/03/15/supervisord-guan-li-nginx-app/"/>
    <updated>2019-03-15T10:47:18+08:00</updated>
    <id>http://liyongxin.github.io/blog/2019/03/15/supervisord-guan-li-nginx-app</id>
    <content type="html"><![CDATA[<p>在使用supervisord管理nginx的时候，发现nginx提示端口占用后异常退出，
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="mi">587</span> <span class="n">INFO</span> <span class="n">RPC</span> <span class="n">interface</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">supervisor</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="n">initialized</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="mi">587</span> <span class="n">CRIT</span> <span class="n">Server</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">unix_http_server</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="n">running</span> <span class="n">without</span> <span class="nb">any</span> <span class="n">HTTP</span> <span class="n">authentication</span> <span class="n">checking</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="mi">588</span> <span class="n">INFO</span> <span class="n">supervisord</span> <span class="n">started</span> <span class="k">with</span> <span class="n">pid</span> <span class="mi">9662</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span><span class="mi">591</span> <span class="n">INFO</span> <span class="n">spawned</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">nginx</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="k">with</span> <span class="n">pid</span> <span class="mi">9664</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span><span class="mi">595</span> <span class="n">INFO</span> <span class="n">spawned</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">app</span><span class="o">-</span><span class="n">gunicorn</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="k">with</span> <span class="n">pid</span> <span class="mi">9665</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span><span class="mi">616</span> <span class="n">INFO</span> <span class="n">exited</span><span class="p">:</span> <span class="n">nginx</span> <span class="p">(</span><span class="nb">exit</span> <span class="n">status</span> <span class="mi">0</span><span class="p">;</span> <span class="ow">not</span> <span class="n">expected</span><span class="p">)</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="mi">610</span> <span class="n">INFO</span> <span class="n">success</span><span class="p">:</span> <span class="n">app</span><span class="o">-</span><span class="n">gunicorn</span> <span class="n">entered</span> <span class="n">RUNNING</span> <span class="n">state</span><span class="p">,</span> <span class="n">process</span> <span class="n">has</span> <span class="n">stayed</span> <span class="n">up</span> <span class="k">for</span> <span class="o">&gt;</span> <span class="n">than</span> <span class="mi">1</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">startsecs</span><span class="p">)</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="mi">628</span> <span class="n">INFO</span> <span class="n">spawned</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">nginx</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="k">with</span> <span class="n">pid</span> <span class="mi">9686</span>
<span class="n">nginx</span><span class="p">:</span> <span class="p">[</span><span class="n">emerg</span><span class="p">]</span> <span class="n">bind</span><span class="p">()</span> <span class="n">to</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">10087</span> <span class="n">failed</span> <span class="p">(</span><span class="mi">98</span><span class="p">:</span> <span class="n">Address</span> <span class="ow">in</span> <span class="n">use</span><span class="p">)</span>
<span class="n">nginx</span><span class="p">:</span> <span class="p">[</span><span class="n">emerg</span><span class="p">]</span> <span class="n">bind</span><span class="p">()</span> <span class="n">to</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">10087</span> <span class="n">failed</span> <span class="p">(</span><span class="mi">98</span><span class="p">:</span> <span class="n">Address</span> <span class="ow">in</span> <span class="n">use</span><span class="p">)</span>
<span class="n">nginx</span><span class="p">:</span> <span class="p">[</span><span class="n">emerg</span><span class="p">]</span> <span class="n">bind</span><span class="p">()</span> <span class="n">to</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">10087</span> <span class="n">failed</span> <span class="p">(</span><span class="mi">98</span><span class="p">:</span> <span class="n">Address</span> <span class="ow">in</span> <span class="n">use</span><span class="p">)</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span><span class="mi">652</span> <span class="n">INFO</span> <span class="n">success</span><span class="p">:</span> <span class="n">nginx</span> <span class="n">entered</span> <span class="n">RUNNING</span> <span class="n">state</span><span class="p">,</span> <span class="n">process</span> <span class="n">has</span> <span class="n">stayed</span> <span class="n">up</span> <span class="k">for</span> <span class="o">&gt;</span> <span class="n">than</span> <span class="mi">1</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">startsecs</span><span class="p">)</span>
<span class="n">nginx</span><span class="p">:</span> <span class="p">[</span><span class="n">emerg</span><span class="p">]</span> <span class="n">bind</span><span class="p">()</span> <span class="n">to</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">10087</span> <span class="n">failed</span> <span class="p">(</span><span class="mi">98</span><span class="p">:</span> <span class="n">Address</span> <span class="ow">in</span> <span class="n">use</span><span class="p">)</span>
<span class="n">nginx</span><span class="p">:</span> <span class="p">[</span><span class="n">emerg</span><span class="p">]</span> <span class="n">bind</span><span class="p">()</span> <span class="n">to</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">10087</span> <span class="n">failed</span> <span class="p">(</span><span class="mi">98</span><span class="p">:</span> <span class="n">Address</span> <span class="ow">in</span> <span class="n">use</span><span class="p">)</span></code></pre></div>
手动执行nginx可以正常启动，查询了一番，找到了如下，不能用daemon的方式启动nginx，所以修改nginx配置，添加<code>daemon off;</code> 后恢复正常
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Supervisord</span> <span class="n">expects</span> <span class="n">nginx</span> <span class="n">to</span> <span class="ow">not</span> <span class="n">fork</span> <span class="n">but</span> <span class="n">remain</span> <span class="ow">in</span> <span class="n">foreground</span><span class="o">.</span> <span class="n">Set</span> <span class="n">daemon</span> <span class="n">to</span> <span class="n">off</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">nginx</span> <span class="n">configuration</span> <span class="nb">file</span></code></pre></div></p>
]]></content>
  </entry>
  
</feed>
